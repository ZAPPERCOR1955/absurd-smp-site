<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABSURD SMP | Home</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #f38020; --twitch: #9146FF; --discord: #5865F2; --glass: rgba(0, 0, 0, 0.85); --border: rgba(255, 255, 255, 0.1); }
        
        /* Updated Background Image Here */
        body { 
            background: linear-gradient(rgba(10, 10, 11, 0.7), rgba(10, 10, 11, 0.7)), url('https://r.jina.ai/i/0556536098714041bc56247ec6cc682a'); 
            background-size: cover; 
            background-attachment: fixed; 
            background-position: center;
            color: white; 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            overflow-x: hidden; 
        }
        
        nav { background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); padding: 20px; position: sticky; top: 0; z-index: 10000; border-bottom: 1px solid var(--border); display: flex; justify-content: center; gap: 30px; }
        nav a { color: #888; text-decoration: none; font-weight: 900; text-transform: uppercase; font-size: 0.9rem; transition: 0.3s; cursor: pointer; }
        nav a:hover, nav a.active { color: var(--primary); }

        .container { max-width: 1100px; margin: auto; padding: 60px 20px; text-align: center; }
        .page-section { display: none; }
        .page-section.active { display: block; }

        .header-panel { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 30px; padding: 50px; margin-bottom: 50px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        h1 { font-size: clamp(2.5rem, 8vw, 5rem); margin: 0; background: linear-gradient(#fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; text-transform: uppercase; letter-spacing: -2px; }
        
        .member-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; }
        .member-card { background: var(--glass); border: 1px solid var(--border); padding: 40px 20px; border-radius: 25px; cursor: pointer; position: relative; transition: 0.3s; }
        .member-card:hover { transform: translateY(-10px); border-color: var(--primary); }
        .member-card.is-live { border-color: #ff4b4b !important; box-shadow: 0 0 25px rgba(255, 75, 75, 0.3); }

        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .gallery-item { background: var(--glass); border-radius: 20px; overflow: hidden; border: 1px solid var(--border); cursor: pointer; transition: 0.3s; }
        .gallery-item:hover { transform: scale(1.02); border-color: var(--primary); }
        .gallery-item img { width: 100%; height: 250px; object-fit: cover; }

        #lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 20000; cursor: zoom-out; }
        #lightbox img { max-width: 90%; max-height: 90%; border-radius: 10px; box-shadow: 0 0 50px rgba(0,0,0,0.8); }

        .btn { padding: 15px 30px; border-radius: 15px; font-weight: 900; text-decoration: none; display: inline-block; margin: 10px; border: none; cursor: pointer; text-transform: uppercase; }
        .btn-primary { background: var(--primary); color: black; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .modal-content { background: #0c0c0d; border: 1px solid var(--border); padding: 50px; border-radius: 40px; text-align: center; position: relative; }
        .close-btn { position: absolute; top: 25px; right: 30px; font-size: 2.5rem; color: #444; cursor: pointer; }
    </style>
</head>
<body>

<nav>
    <a id="nav-home" onclick="showPage('home')" class="active">Home</a>
    <a id="nav-gallery" onclick="showPage('gallery')">Gallery</a>
</nav>

<div id="lightbox" onclick="this.style.display='none'"><img src="" id="lightbox-img"></div>

<div class="container">
    <div id="home" class="page-section active">
        <div class="header-panel">
            <h1>Absurd SMP</h1>
            <p id="server-status" style="font-weight: 800; color: #777; margin-top: 20px;">CHECKING SERVER...</p>
            <div style="margin-top: 25px;">
                <button class="btn btn-primary" onclick="copyIP()">Copy IP</button>
                <a href="https://discord.gg/MUFD22facY" target="_blank" class="btn btn-primary" style="background:#5865F2; color:white;">Discord</a>
            </div>
        </div>
        <div class="member-grid" id="member-grid"></div>
    </div>

    <div id="gallery" class="page-section">
        <div class="header-panel">
            <h1>Server Gallery</h1>
            <p style="color:#777">Builds and photos from the Absurd world.</p>
        </div>
        <div class="gallery-grid" id="gallery-list"></div>
    </div>
</div>

<div class="modal" id="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <img id="p-body" src="" style="width: 250px; margin-bottom: 20px;">
        <h2 id="p-name" style="font-size: 2.5rem; font-weight: 900; text-transform: uppercase;">Player</h2>
        <a id="p-yt" href="#" target="_blank" class="btn btn-primary">YouTube</a>
        <a id="p-twitch" href="#" target="_blank" class="btn btn-primary" style="background:#9146FF; color:white;">Twitch</a>
    </div>
</div>

<script>
    // --- GITHUB CONFIG ---
    const GITHUB_USER = "YourUsername"; //
    const REPO_NAME = "YourRepo"; //

    async function loadGallery() {
        const container = document.getElementById('gallery-list');
        container.innerHTML = '';
        try {
            const res = await fetch(`https://api.github.com/repos/ZAPPERCOR1955/absurd-smp-site/contents/gallery`);
            const files = await res.json();
            const images = files.filter(f => f.name.match(/\.(jpg|jpeg|png|gif)$/i));
            images.forEach(f => {
                const item = document.createElement('div');
                item.className = 'gallery-item';
                item.onclick = () => { document.getElementById('lightbox-img').src = f.download_url; document.getElementById('lightbox').style.display = 'flex'; };
                item.innerHTML = `<img src="${f.download_url}">`;
                container.appendChild(item);
            });
        } catch (e) { console.error("Gallery failed", e); }
    }

    function showPage(pageId) {
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.getElementById('nav-' + pageId).classList.add('active');
        if(pageId === 'gallery') loadGallery();
    }

    const TWITCH_CLIENT_ID = 'h3u5xqt2omzby9zoshbixb20oytip8';
    const TWITCH_SECRET = 'kj1udguy15ax1s2exy13ba4zaqapw1';
    const members = [
        { name: 'zappercor1955', uuid: '8429c0a0-5912-48dc-aa6c-cb4ce079c019', twitch: 'zappercor1955', ytId: 'UC5yAOhjDAfNwpRjD9sU9iGw', ytLink: 'https://youtube.com/@zappercor' },
        { name: 'SP_Bubbles', uuid: 'af386647-2d8b-4f2e-807f-d82fd794b894', twitch: '', ytId: 'UCml1QZ1gCQzoPuo55qXUITg', ytLink: 'https://youtube.com/@SP_Bubbles' },
        { name: 'Specrius', uuid: '268b0488-9068-49f7-8b67-e8f33bbada5e', twitch: 'specrius', ytId: 'UCz1RQ-KNKmlnYyzLntBI_TA', ytLink: 'https://youtube.com/@SpecriusXD' },
        { name: 'Sanderhaukk', uuid: '6d70ceb2-9955-4c56-a791-b2d28e6f38c1', twitch: 'sanderhaukk', ytId: 'UCwbl_shs76aXko7TPJht90w', ytLink: 'https://youtube.com/@sanderhauk' },
        { name: 'schmockle', uuid: '4b99cf2a-1dd7-4ce4-a71d-49d970ead40c', twitch: 'grimbleds', ytId: 'UCbAYY7PxCdk7Uyxhjf-aZWg', ytLink: 'https://youtube.com/@schmuckle7239' }
    ];

    async function updateAutomatedStatus() {
        try {
            const tokenRes = await fetch(`https://id.twitch.tv/oauth2/token?client_id=${TWITCH_CLIENT_ID}&client_secret=${TWITCH_SECRET}&grant_type=client_credentials`, { method: "POST" });
            const tokenData = await tokenRes.json();
            const token = tokenData.access_token;
            const twitchLogins = members.map(m => m.twitch).filter(Boolean).join('&user_login=');
            let liveUsers = [];
            if (twitchLogins) {
                const tRes = await fetch(`https://api.twitch.tv/helix/streams?user_login=${twitchLogins}`, { headers: { "Client-ID": TWITCH_CLIENT_ID, "Authorization": `Bearer ${token}` } });
                const tData = await tRes.json();
                liveUsers = (tData.data || []).map(s => s.user_login.toLowerCase());
            }
            for (let m of members) {
                m.isLive = false; m.newVideo = false; // Reset
                m.isLive = m.twitch && liveUsers.includes(m.twitch.toLowerCase());
                if (!m.isLive && m.ytId) {
                    try {
                        const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${m.ytId}`;
                        const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}`);
                        const data = await res.json();
                        const xml = new DOMParser().parseFromString(data.contents, "text/xml");
                        const latest = xml.querySelector("entry");
                        if (latest) {
                            const pubDate = new Date(latest.querySelector("published").textContent);
                            m.newVideo = (Date.now() - pubDate.getTime()) / 3600000 < 48;
                        }
                    } catch (e) { console.error(e); }
                }
            }
            renderMembers();
        } catch (err) { console.error(err); renderMembers(); }
    }

    function renderMembers() {
        const grid = document.getElementById('member-grid');
        grid.innerHTML = '';
        members.forEach(m => {
            const card = document.createElement('div');
            card.className = `member-card ${m.isLive ? 'is-live' : ''}`;
            card.onclick = () => {
                document.getElementById('p-name').innerText = m.name;
                document.getElementById('p-yt').href = m.ytLink;
                document.getElementById('p-body').src = `https://visage.surgeplay.com/full/400/${m.uuid}`;
                const twBtn = document.getElementById('p-twitch');
                if (m.twitch) { twBtn.href = `https://twitch.tv/${m.twitch}`; twBtn.style.display = 'inline-block'; }
                else { twBtn.style.display = 'none'; }
                document.getElementById('modal').style.display = 'flex';
            };
            let badge = m.isLive ? '<div class="live-badge">LIVE</div>' : (m.newVideo ? '<div class="live-badge" style="background:var(--primary)">NEW VIDEO</div>' : '');
            card.innerHTML = `${badge}<img src="https://visage.surgeplay.com/full/200/${m.uuid}" class="avatar-img"><h3>${m.name}</h3>`;
            grid.appendChild(card);
        });
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function copyIP() { navigator.clipboard.writeText("play.AbsurdSMP.com"); alert("IP Copied!"); }
    function updateServerStatus() { fetch('https://api.mcsrvstat.us/2/play.AbsurdSMP.com').then(r => r.json()).then(data => { document.getElementById('server-status').innerHTML = data.online ? `<span style="color:#4ade80">● ONLINE</span> — ${data.players.online}/${data.players.max} PLAYERS` : `<span style="color:#ff4d4d">● OFFLINE</span>`; }); }

    updateServerStatus(); updateAutomatedStatus();
    setInterval(updateAutomatedStatus, 60000); setInterval(updateServerStatus, 60000);
</script>
</body>
</html>
